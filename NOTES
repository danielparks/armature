Splitting it up into prepare and activate steps means that branches and tags can't be updated as we go along. That also means:
  - That information has to be tracked in memory, so that two references to a new branch don't result in two objects.
  - Garbage collection must not collect those objects between the prepare and activate steps, even though a process likely won't be running to hold a lock on them.

It might make sense to run our own webhook, rather than relying on a wrapper like Jenkins.

I could add a ref cache that gets filled when I get branch names. That allows me to avoid a git ref lookup every time I update a branch.

Maybe I should git rid of update and make sure deploy updates branches.
